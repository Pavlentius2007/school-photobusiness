# üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

## ‚úÖ **–°—Ç–∞—Ç—É—Å: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!**

### **üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**

#### **1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- **`users`** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (admin, curator, student)
- **–†–æ–ª–∏**: admin, curator, student
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: JWT —Ç–æ–∫–µ–Ω—ã —Å bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

#### **2. –ö—É—Ä—Å—ã –∏ –æ–±—É—á–µ–Ω–∏–µ**
- **`courses`** - –∫—É—Ä—Å—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- **`modules`** - –º–æ–¥—É–ª–∏ –∫—É—Ä—Å–æ–≤
- **`lessons`** - —É—Ä–æ–∫–∏ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (—Ç–µ–∫—Å—Ç, –≤–∏–¥–µ–æ, —Ñ–∞–π–ª—ã)

#### **3. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã**
- **`tests`** - —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–Ω–∞–Ω–∏–π
- **`questions`** - –≤–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–æ–≤ (–æ—Ç–∫—Ä—ã—Ç—ã–µ, –≤—ã–±–æ—Ä)
- **`answers`** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- **`assignments`** - –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
- **`assignment_submissions`** - –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

#### **4. –ü—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
- **`course_progress`** - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫—É—Ä—Å–∞–º
- **`lesson_progress`** - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —É—Ä–æ–∫–∞–º
- **`test_attempts`** - –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- **`test_answers`** - –æ—Ç–≤–µ—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –Ω–∞ —Ç–µ—Å—Ç—ã

#### **5. –ü–ª–∞—Ç–µ–∂–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã**
- **`payments`** - –ø–ª–∞—Ç–µ–∂–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **`course_enrollments`** - –∑–∞—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ –∫—É—Ä—Å—ã
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: –ÆKassa, –°–±–µ—Ä–±–∞–Ω–∫, CloudPayments, Stripe

#### **6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—É–¥–∏—Ç**
- **`activity_logs`** - –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **`notifications`** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### **üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

#### **ORM –∏ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- **SQLAlchemy** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **Alembic** - —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π
- **PostgreSQL 15** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–µ—Ä–µ–¥–∏

#### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π**: bcrypt —Å —Å–æ–ª—å—é
- **JWT —Ç–æ–∫–µ–Ω—ã**: –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–†–æ–ª–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**: –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è

#### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **–ò–Ω–¥–µ–∫—Å—ã**: –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª—è—Ö
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis –¥–ª—è API –æ—Ç–≤–µ—Ç–æ–≤
- **–°–≤—è–∑–∏**: –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ —Å CASCADE —É–¥–∞–ª–µ–Ω–∏–µ–º
- **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è PostgreSQL

### **üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î:**

#### **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:**
```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
cd backend
python init_database.py

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision --autogenerate -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head

# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
alembic downgrade -1
```

#### **Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose logs postgres

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
docker-compose exec postgres psql -U postgres -d learning_platform

# –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
docker-compose exec postgres pg_dump -U postgres learning_platform > backup.sql
```

### **üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:**

```
backend/
‚îú‚îÄ‚îÄ alembic/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic
‚îÇ   ‚îú‚îÄ‚îÄ versions/              # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ env.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ script.py.mako         # –®–∞–±–ª–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ models/                # –ú–æ–¥–µ–ª–∏ SQLAlchemy
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py           # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ course.py         # –ö—É—Ä—Å—ã, –º–æ–¥—É–ª–∏, —É—Ä–æ–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test.py           # –¢–µ—Å—Ç—ã –∏ –≤–æ–ø—Ä–æ—Å—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assignment.py     # –ó–∞–¥–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment.py        # –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ activity.py       # –õ–æ–≥–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ core/
‚îÇ       ‚îî‚îÄ‚îÄ database.py       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ alembic.ini               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îú‚îÄ‚îÄ init_database.py          # –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ init.sql                  # –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### **üìä –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

#### **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**: admin@example.com / admin123
- **–ö—É—Ä–∞—Ç–æ—Ä**: curator@example.com / curator123
- **–°—Ç—É–¥–µ–Ω—Ç**: student@example.com / student123

#### **–ö—É—Ä—Å—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
1. **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ —à–∫–æ–ª–∞—Ö/—Å–∞–¥–∞—Ö** (19,900 ‚ÇΩ)
2. **–î–∏–∑–∞–π–Ω –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞–∫–µ—Ç–æ–≤** (49,900 ‚ÇΩ)
3. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ + –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** (98,000 ‚ÇΩ)

#### **–ú–æ–¥—É–ª–∏ –∏ —É—Ä–æ–∫–∏:**
- –ö–∞–∂–¥—ã–π –∫—É—Ä—Å —Å–æ–¥–µ—Ä–∂–∏—Ç 2 –º–æ–¥—É–ª—è
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç 1-2 —É—Ä–æ–∫–∞
- –£—Ä–æ–∫–∏ –≤–∫–ª—é—á–∞—é—Ç —Ç–µ—Å—Ç—ã –∏ –∑–∞–¥–∞–Ω–∏—è

### **üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞:**

#### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
\dt

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT id, email, role, is_active FROM users;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É—Ä—Å–æ–≤
SELECT id, title, status, price FROM courses;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
SELECT 
    u.email,
    c.title,
    cp.progress_percentage
FROM course_progress cp
JOIN users u ON cp.user_id = u.id
JOIN courses c ON cp.course_id = c.id;
```

#### **–õ–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```bash
# –õ–æ–≥–∏ PostgreSQL
docker-compose logs postgres

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose logs backend

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats
```

### **üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:**

#### **‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- [x] –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic
- [x] –ú–æ–¥–µ–ª–∏ SQLAlchemy
- [x] –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- [x] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

#### **üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**
1. **–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL** –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é** master-slave
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã**
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
6. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**

### **üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞:**

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs postgres`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `docker-compose exec postgres psql -U postgres -d learning_platform`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏: `docker-compose exec backend alembic current`
4. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É: `docker-compose down -v && docker-compose up -d`

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ! üéâ** 