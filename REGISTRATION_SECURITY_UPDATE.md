# Обновление системы регистрации для повышения безопасности

## Обзор изменений

Согласно требованиям безопасности, внесены изменения в систему регистрации пользователей:

1. **Убрано поле "Роль"** из публичной формы регистрации
2. **Добавлена функциональность создания кураторов** в админ-панели
3. **Ограничен доступ** к созданию кураторов только для администраторов

## Изменения в коде

### 1. Обновление формы регистрации (`frontend/src/pages/RegisterPage.tsx`)

#### Удаленные элементы:
- Поле выбора роли (select с опциями "Студент" и "Куратор")
- Состояние `role` в `formData`
- Логика обработки выбора роли

#### Добавленные изменения:
- Установлена роль "student" по умолчанию для всех новых пользователей
- Упрощен тип `handleChange` (убрана поддержка `HTMLSelectElement`)

```typescript
// Было:
const [formData, setFormData] = useState({
  email: '',
  password: '',
  confirmPassword: '',
  fullName: '',
  role: 'student' // Удалено
});

// Стало:
const [formData, setFormData] = useState({
  email: '',
  password: '',
  confirmPassword: '',
  fullName: ''
});

// При регистрации автоматически устанавливается роль 'student'
await register({
  email: formData.email,
  password: formData.password,
  full_name: formData.fullName,
  role: 'student' // Фиксированная роль
});
```

### 2. Добавление функциональности в админ-панель (`frontend/src/pages/admin/UsersManagementPage.tsx`)

#### Новые состояния:
```typescript
const [showCreateCuratorModal, setShowCreateCuratorModal] = useState(false);
const [newCuratorData, setNewCuratorData] = useState({
  email: '',
  firstName: '',
  lastName: '',
  password: ''
});
const [isCreatingCurator, setIsCreatingCurator] = useState(false);
```

#### Новые функции:
- `handleCreateCurator()` - создание нового куратора
- `handleCuratorDataChange()` - обработка изменений в форме создания куратора

#### Новые UI элементы:
- Кнопка "Создать куратора" в заголовке страницы
- Модальное окно с формой создания куратора
- Валидация полей формы
- Обработка состояний загрузки

## Безопасность

### Контроль доступа
- **Публичная регистрация**: Только для студентов
- **Создание кураторов**: Только через админ-панель администраторами
- **Создание администраторов**: Не предусмотрено через UI (только через базу данных)

### Валидация данных
- Проверка заполнения всех обязательных полей
- Валидация email формата
- Проверка минимальной длины пароля (6 символов)
- Проверка совпадения паролей

## Пользовательский интерфейс

### Форма регистрации
- Упрощенный интерфейс без выбора роли
- Четкое указание, что регистрируются только студенты
- Улучшенная доступность и UX

### Админ-панель
- Интуитивная кнопка создания куратора
- Модальное окно с профессиональным дизайном
- Обратная связь о статусе операций
- Возможность отмены операции

## API изменения

### Регистрация пользователя
```typescript
// Endpoint: POST /api/auth/register
// Теперь всегда создает пользователя с ролью 'student'
{
  "email": "user@example.com",
  "password": "password123",
  "full_name": "Иван Иванов",
  "role": "student" // Фиксированное значение
}
```

### Создание куратора (только для админов)
```typescript
// Endpoint: POST /api/admin/users/curators
// Требует права администратора
{
  "email": "curator@example.com",
  "password": "password123",
  "first_name": "Анна",
  "last_name": "Петрова",
  "role": "curator"
}
```

## Тестирование

### Сценарии тестирования
1. **Публичная регистрация**:
   - Регистрация нового пользователя
   - Проверка, что роль автоматически установлена как "student"
   - Проверка валидации полей

2. **Создание куратора**:
   - Вход в админ-панель с правами администратора
   - Открытие модального окна создания куратора
   - Заполнение и отправка формы
   - Проверка создания куратора в списке пользователей

3. **Безопасность**:
   - Попытка доступа к созданию куратора без прав администратора
   - Проверка, что обычные пользователи не могут создавать кураторов

## Развертывание

### Порядок обновления
1. Обновить фронтенд код
2. Перезапустить приложение
3. Проверить работу публичной регистрации
4. Проверить функциональность админ-панели
5. Обновить документацию для администраторов

### Откат изменений
В случае необходимости отката:
1. Восстановить поле "Роль" в форме регистрации
2. Удалить функциональность создания кураторов из админ-панели
3. Обновить API для поддержки выбора роли при регистрации

## Документация для администраторов

### Создание куратора
1. Войти в админ-панель с правами администратора
2. Перейти в раздел "Управление пользователями"
3. Нажать кнопку "Создать куратора"
4. Заполнить форму:
   - Имя
   - Фамилия
   - Email
   - Пароль (минимум 6 символов)
5. Нажать "Создать куратора"
6. Новый куратор появится в списке пользователей

### Безопасность
- Пароли кураторов должны быть достаточно сложными
- Рекомендуется использовать временные пароли с обязательной сменой при первом входе
- Регулярно проверять список кураторов и их активность

## Заключение

Внесенные изменения значительно повышают безопасность системы:
- Исключена возможность несанкционированного создания кураторов
- Упрощена публичная регистрация
- Добавлен контроль доступа к административным функциям
- Улучшен пользовательский интерфейс

Система теперь соответствует принципам минимальных привилегий и обеспечивает безопасное управление пользователями. 